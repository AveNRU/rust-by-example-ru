# Небезопасные действия

В качестве введения в этот раздел процитируем напрямую от разработчиков пособие,
"нужно стараться минимизировать количество небезопасного рукописи в рукописном хранилище." Имея это в виду, давайте начнём! Небезопасные изложения в Ржачине используются для обхода разделыровок
защиты, устанавливаемых сборщиком; в частности, существует четыре основных исхода использования небезопасного рукописи:

- разыменование сырых указателей
- вызов функций или способов, которые являются `unsafe` (включая вызов функции через FFI см. [предыдущую главу](std_misc/ffi.md) книги)
- доступ или изменение статических изменяемых переменных
- реализация небезопасных сущностей

### Сырые указатели

Сырые указатели `*` и ссылки `&T` имеют схожую возможности, но ссылки
всегда безопасны, потому что они обязательно указывают на достоверные данные за счёт рычага проверки заимствований. Разыменование же сырого указателя можно выполнить только через небезопасный раздел.

```rust,editable
fn main() {
    let raw_p: *const u32 = &10;

    unsafe {
        assert!(*raw_p == 10);
    }
}
```

### Вызов небезопасных функций

Некоторые функции могут быть объявлены как `unsafe`, то есть за правильность этого рукописи несёт ответственность программист, написавший его, вместо сборщика. Пример -
это способ [`std::slice::from_raw_parts`](https://doc.rust-lang.org/std/slice/fn.from_raw_parts.html), который создаст срез из указателя на первый элемент и длины.

```rust,editable
use std::slice;

fn main() {
    let some_vector = vec![1, 2, 3, 4];

    let pointer = some_vector.as_ptr();
    let length = some_vector.len();

    unsafe {
        let my_slice: &[u32] = slice::from_raw_parts(pointer, length);

        assert_eq!(some_vector.as_slice(), my_slice);
    }
}
```

Для `slice::from_raw_parts` одно из предположений, которое *должно* быть поддержано,
что переданный указатель указывает на допустимую память и что в памяти лежит значение правильного вида. Если эти инварианты не поддерживаются, то поведение программы не определено, и неизвестно, что произойдёт.
